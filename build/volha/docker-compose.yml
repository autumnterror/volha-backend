services:
  dumper:
    container_name: dumper
    image: zitrax78/dumper:latest
    depends_on:
      - productsdb
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_HOST: productsdb
      POSTGRES_PORT: "5432"
    volumes:
      - ./dumps:/dumps

  redis:
    container_name: redis
    image: redis:latest
    ports:
      - "6379:6379"
    restart: unless-stopped
    command: --requirepass ${REDISPASSWD}
    env_file: .env

  productsdb:
    container_name: productsdb
    image: postgres:latest
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    restart: unless-stopped
    env_file: .env
  product-service:
    container_name: product-service
    image: zitrax78/product-service:latest
    ports:
      - "8008:8008"
    volumes:
      - ./configs:/app/configs
    environment:
      CONFIG_PATH: configs/product-service.yaml
    restart: unless-stopped
  volha-gateway:
    container_name: volha-gateway
    image: zitrax78/volha-gateway:latest
    ports:
      - "8080:8080"
    volumes:
      - ./configs:/app/configs
      - ./images:/app/images
    environment:
      CONFIG_PATH: configs/volha-gateway.yaml
    restart: unless-stopped

volumes:
  postgres-data:
