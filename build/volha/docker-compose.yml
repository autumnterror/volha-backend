services:
  volha-dumper:
    container_name: volha-dumper
    image: zitrax78/dumper:latest
    depends_on:
      - volha-productsdb
    environment:
      - POSTGRES_HOST=volha-productsdb
    volumes:
      - ./dumps:/dumps
      -  .env:/app/.env
    restart: unless-stopped
    
  volha-redis:
    container_name: volha-redis
    image: redis:latest
    ports:
      - "6379:6379"
    restart: unless-stopped
    command: --requirepass ${REDISPASSWD}
    env_file: .env

  volha-productsdb:
    container_name: volha-productsdb
    image: postgres:latest
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    restart: unless-stopped
    env_file: .env

  volha-product-service:
    container_name: volha-product-service
    image: zitrax78/product-service:latest
    ports:
      - "8008:8008"
    volumes:
      - ./configs:/app/configs
      - .env:/app/.env
    environment:
      CONFIG_PATH: configs/product-service.yaml
    restart: unless-stopped
    depends_on:
      - volha-productsdb

  volha-gateway:
    container_name: volha-gateway
    image: zitrax78/volha-gateway:latest
    ports:
      - "8080:8080"
    volumes:
      - ./configs:/app/configs
      - ./images:/app/images
      - .env:/app/.env
    environment:
      CONFIG_PATH: configs/volha-gateway.yaml
    restart: unless-stopped
    depends_on:
      - volha-product-service
      - volha-redis
volumes:
  postgres-data:
